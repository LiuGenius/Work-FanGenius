# 心理健康调试云平台技术备案

#### 用户角色设计
- ##### 1.超级管理员（superAdmin)

| 字段名|描述|类型|
| --------- | -----:| -----:|
|_id|用户编号|**Long**|
|userName|用户名|**String**|
|password|密码|**String**|
|registerTime|注册时间|**Long**|
|company|所属单位|**String**|

- ##### 2.管理员/老师(admin)

| 字段名|描述|类型|
| --------- | -----:| -----:|
|所属管理员|所属管理员Id|**Long**|
|其他字段同超级管理员|-|-|


- ##### 3.用户/学生/患者(user)

| 字段名|描述|类型|
| --------- | -----:| -----:|
|_id|用户编号|**Long**|
|userName|用户名|**String**|
|password|密码|**String**|
|registerTime|注册时间|**Long**|
|company|所属单位|**String**|
|sex|性别|**int**|
|age|年龄|**int**|
|mobile|手机号/用户联系方式|**String**|
|photo|用户头像|**String-Url**|
|lastLoginTime|上次登录时间|**Long**|
|lastLoginAddress|上次登录地点|**Long**|
|loginEquiList|登录设备列表|**String[]**|
|adminId|所属管理员Id|**Long**|


#### 在线即时通讯
[技术备案地址](https://netease.im/im?from=bdjj2006y5594 "网易云信")

- ##### 1.文字消息
- ##### 2.语音消息
- ##### 3.多媒体文件消息(视频/图片/音频/文本)
- ##### 4.消息即时推送
- ##### 5.聊天记录存储在本地数据库


> 待更新 2020/05/27


> 更新于 2020/07/16

#### 功能模块

##### 基本所有模块数据都是直接导入数据库的，只需要查询接口。个别模块需要有添加数据接口，不需要修改和删除数据的接口

##### 一级模块：A.首页，B.沙盘，C.助眠，D.个人中心
##### 二级模块：E.冥想，F.心呼吸，G.番茄钟，H.助眠，I.心理电台，J.解忧商店，K.心理游戏，L.心理知识，M.VR放松，N.咨询，O.治愈音乐，P.呼吸训练，Q.减压训练，R.预约咨询，S.在线咨询,T.我的收藏，U.我的预约，V.咨询记录，W.关于，X.个人信息，Y.其他。

| 模块名|编号|模块等级|功能|
| --------- | -----:| -----:| -----:|
|**首页**|**A**|一级模块|a.获取轮播图，b.获取教师数据，c.获取新闻数据|
|**沙盘**|**B**|一级模块|a.获取沙具分类，b.根据分类获取沙具列表|
|**助眠**|**C**|一级模块|a.获取助眠音乐分类，b.根据音乐分类获取音乐列表|
|**个人中心**|**D**|一级模块|a.获取个人信息，b.修改个人信息|
|冥想|E|二级模块|a.获取冥想分类，b.根据冥想分类获取冥想列表，c.获取冥想详情数据|
|心呼吸|F|二级模块|a.获取心呼吸列表，b.获取心呼吸详情数据|
|番茄钟|G|二级模块|a.获取番茄钟列表，b.获取番茄钟详情数据|
|助眠|H|二级模块|跳转到一级模块|
|心理电台|I|二级模块|a.获取一条心理电台信息，b.上一条，下一条|
|解忧商店|J|二级模块|a.随机获取一条信息，b.发送一条信息|
|心理游戏|K|二级模块|待定|
|心理知识|L|二级模块|a.获取心理知识列表，b.获取信息知识详情|
|VR放松|M|二级模块|a.获取VR场景列表，b.获取详情|
|咨询|N|二级模块|a.在线咨询(即时聊天)|
|治愈音乐|O|二级模块|a.获取音乐列表，b.获取音乐详情|
|呼吸训练|P|二级模块|待定|
|减压训练|Q|二级模块|待定|
|预约咨询|R|二级模块|a.提交一条咨询|
|在线咨询|S|二级模块|跳转到在线咨询(即时聊天)|
|我的收藏|T|二级模块|a.获取收藏列表，b.获取收藏详情|
|我的预约|U|二级模块|a.获取R模块提交的预约列表，b.获取预约详情|
|咨询记录|V|二级模块|a.获取咨询记录，b.获取咨询记录详情|
|关于|W|二级模块|写死界面|
|个人信息|X|二级模块|a.获取个人信息，b.修改个人信息|
|其他|Y|二级模块|其他|


> 更新于 2020/09/03

### 接口需求（按模块）
##### 漂流瓶修改完善

- ##### 1.瓶子信息  driftBottle

| 字段名|描述|类型|
| --------- | -----:| -----:|
|_id|编号|**Long**|
|content|内容|**String**|
|userName|发送人姓名|**String**|
|userId|发送人ID|**Long**|
|replyList|回复列表|**Array**|

- ##### 2.回复列表 reply

| 字段名|描述|类型|
| --------- | -----:| -----:|
|_id|编号|**Long**|
|content|内容|**String**|
|userName|回复人姓名|**String**|
|userId|回复人ID|**Long**|

 ### 接口列表

- #### 1.扔出一个漂流瓶
	- ##### 用户ID
	- ##### 用户姓名
	- ##### 漂流瓶内容

- #### 2.检一个漂流瓶    (自动将这个漂流瓶加入 "我的瓶子")
	- ##### 用户ID
	- ##### 用户姓名

- #### 3.回复/不回复扔回海里 （自动将这个漂流瓶从 "我的瓶子"删除)
	- ##### 瓶子ID
	- ##### 用户ID
	- ##### 用户姓名
	- ##### 是否回复
	- ##### 回复内容(是否回复为TRUE才有数据)

- #### 4.我的瓶子 
	- ##### 用户ID
	- ##### 类型 0：全部 1：我扔的  2：我捡的 
###### tips:分为 "我扔的" "我捡的" 由我扔出的瓶子自动加入 "我扔的"分类 ，不可删除 。"我捡的"由接口二和接口三数据互相关联


> 更新于 2020/09/05

- #### 1.预约咨询
	- ##### 预约手机号
	- ##### 姓名
	- ##### 年龄
	- ##### 性别
	- ##### 单位/学校 非必填
	- ##### 身份证 非必填
	- ##### 预约原因 
	- ##### 预约时间 年/月/日 时：分

- #### 2.我的预约
	查询我提交的预约申请

> 更新于 2020/09/16

- #### 1.我的单位/学校信息
###### 获取用户设置的单位学校信息

- #### 2.用户设置心情
	- ##### 心情ID
###### 心情分为 激动/难过/愤怒/欢喜/忧愁/恐惧/无（默认）


> 更新于 2020/09/17

## 平板端接口


###### 只能管理和查看到单位/学校为当前登录单位的用户
- #### 1.用户搜索
	- ##### 性别
	- ##### 年龄区间
	- ##### 姓名(模糊查询)


- #### 2.修改用户信息
	- ##### 用户对象 / 若数据为空则不修改
	
- #### 3.删除用户信息（物理删除）
	- ##### 用户ID
	
- #### 4.用户统计（此处为需要服务器返回的信息，这个接口信息后期可能要加数据） 
	- ##### 总用户人数
	- ##### 男性用户人数
	- ##### 女性用户人数
	- ##### 每个年龄阶段用户人数(10年为一个阶段)
	
- #### 5.机构添加教员信息（教员信息只是一条数据，不是用户信息）
	
```java
/**
 * 心理教员
 */
public class PsychologicalMentor {
    private long _id;//ID
    private String photo;//头像
    private String name;//姓名
    private String describe;//描述
    private String consultingNum;//咨询人数
    private int WorkingYears;//工作年限
    private String personalIntroduction;//个人介绍
    private String workIntroduction;//工作介绍
}
```
- #### 6.机构修改信息（机构修改名称/描述/简介信息）

- #### 7.心情统计(获取每种心情的用户人数)

> 更新于 2020/09/21

###### ps:机构注册需要填写手机号和密码，通过手机号和密码可以登录管理员端。同时使用手机号注册网易云信的通信账号，将手机号作为账号

- #### 1.登录接口修改
	- ##### 添加数据 管理员ID
	
- #### 2.独立分开机构登录和用户登录接口

- #### 3.用户注册功能修改为只能用户注册，添加机构为独立接口或者使用手动导入添加新的机构

- #### 4.用户提交预约申请不需要再选择机构和预约时间，直接取当前登录用户的机构

- #### 5.机构查询预约信息/查询机构下用户的所有预约单
	- ##### 查询状态 1：所有  2：已经确认  3：未确认
	
- #### 6.机构处理预约申请
	- ##### 预约单号ID
	- ##### 预约时间
##### 6.1提交成功后将预约单设置为：已经确认
##### 6.2操作状态为已确认的预约单为修改时间

- #### 7.心理知识
	- ##### 随机获取10条心理知识的数据
##### 7.1后续 <font color="#4590a3">可能</font> 会有 图片/视频/链接的数据


> 更新于 2020/10/15

- #### 1.用户信息添加remake字段

- #### 2.用户信息添加useHistory字段  array<String>
	- ##### 这个字段可以无限添加
	- ##### 例 ["{"content":"使用了xxx功能","time":"2020/10/15 12:12:12",type:1}","这里的文本只需要做字符串存储,可以是任何格式的文本",...]
	
- #### 3.用户信息修改接口:/user/update 没有传得数据不做更改(这个我没试，如果已经是这样子得话就忽略这条)


> 更新于 2020/10/17

- ### 内容管理功能 (管理员设置手机端的功能模块可见或者不可见/模块直接写死)

#### 先全部手动添加,所有内容默认为true

| 冥想|疗愈音乐|番茄钟|心呼吸|人物哄睡|心理电台|
| --------- | -----:| -----:| -----:| -----:| -----:|
|**解忧商店**|**呼吸训练**|**减压训练**|**心理游戏**|**咨询**|**-**|

- #### 1.获取所有类别信息
	- ##### 传递数据示例:无
	- ##### 需要返回数据示例: {"冥想":true,"疗愈音乐":false,......}
	
- #### 2.修改类别信息	
	- ##### 传递数据示例: {"冥想":false}
	- ##### 需要返回数据示例: {"code":0/1}
	



更新于 2020/10/19

漂流瓶管理

- #### 1.查看当前机构用户所有的漂流瓶(带评论)

- #### 2.删除漂流瓶

用户管理

- #### 3.获取情绪获取用户列表
	- ##### 传递数据示例: {"mood":"激动"} | {"mood":"无"}
	- ##### 需要返回数据示例: userList
	
咨询师操作台功能 - 课堂记录模块

- #### 4.添加课堂记录
	- ##### 传递数据示例: 
	
	```
	public class ClassRecord {
		private long _id;//Id
		private String time;//日期
		private String className;//班级名称
		private int number;//上课人数
		private String address;//上课地点
		private String teacherName;//教师姓名
		private String title;//标题
		private String content;//内容
		private ArrayList<String> videoUrlList;//视频列表
		private ArrayList<String> imageUrlList;//图片列表
	```
	
	- ##### 需要返回数据示例: result
	
- #### 5.获取课堂记录列表
	
	
更新于 2020/10/22

- #### 1.用户信息添加 "心理评分 "字段,初始分值100分
	- ##### a.现有返回用户信息的接口都需要加上这个字段
	- ##### b.新接口:  修改用户心理评分
		- ###### 传递数据示例: {"id":123456789,"score":-5}
		- ###### 需要返回数据示例: result
		
- #### 2.课堂记录修改
	```
	//删除频列表和图片列表字段
	//private ArrayList<String> videoUrlList;//视频列表
	//private ArrayList<String> imageUrlList;//图片列表
	//添加附件列表字段
	private ArrayList<String> attachmentUrlList;//附件列表
	
	```
	
	
更新于 2020/10/29

- #### 机构添加字段  "到期时间" 该字段隐藏,不显示在任何接口
	- ##### 机构端用户端登录时都检查机构这个字段是否在有效期内,如果过期的话,不予许登录
	- ##### 该字段只能直接修改数据库
	- ##### 该字段过期后每三天给机构端用户发送一条短信,提醒用户权限过期
	
更新于 2020/11/06

- #### 1.番茄钟修改
	###### tips:现在这个模块是先通过/pomodoro/listCategory获取列表再获取详情pomodoro/getResource的方式进行,修改为直接获取所有数据,并且图片每个模块都只留下一张不需要多张了
	- ##### 1.1.删除pomodoro/getResource接口
	- ##### 1.2.pomodoro/listCategory修改
	```
	//当前接口数据
	
	{
		"media": {
			"name": null,
			"url": null
		},
		"surfaceList":
			[
				{
					"name": "蒙版组 103.png",
					"url": "http://121.41.72.72:81/pomodoro/寝室/蒙版组 103.png"
				},
				{
					"name": "蒙版组 102.png",
					"url": "http://121.41.72.72:81/pomodoro/寝室/蒙版组 102.png"
				},
			...
			]
	}
	
	//修改为
	
	{
		  "name": "地铁内",
		  "code": "9d196c1a6e33b27003e90a8869439ede",
		  "mediaUrl":"http://121.41.72.72:81/pomodoro/地铁内/番茄钟：地铁内.mp3",
		  "coverUrl":"http://121.41.72.72:81/pomodoro/地铁内/蒙版组 102.png"
    },
    {
		  "name": "寝室",
		  "code": "ee6381fd6d65ac573bcde0fd532c4dd8"
		  "mediaUrl":"http://121.41.72.72:81/pomodoro/寝室/番茄钟：寝室.mp3",
		  "coverUrl":"http://121.41.72.72:81/pomodoro/寝室/蒙版组 102.png"
    },
    	.....
	
	```
	
- #### 2.人物哄睡和心理电台区分机构数据
	###### tips:人物哄睡和心理电台按机构区分数据,把现有的数据复制一份到另外的文件夹,以后当用户添加或者修改的时候,只修改或添加对应机构的数据
	

- #### 3.模块添加数据(人物哄睡和心理电台需要传orgID)
	###### tips:对应的模块名称添加对应数据但是没有ID,需要添加时设置id
	- ##### 请求参数示例:
	```
	{
		"moduleName":"番茄钟",
		"params":{
			  "name": "福利姬卧室",
			  "code": "9d196c1a6e33b27003e90a8869439ede",
			  "mediaUrl":"http://xxxxx:81/pomodoro/福利姬卧室/番茄钟：福利姬卧室.mp3",
			  "coverUrl":"https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1747304339,957765850&fm=26&gp=0.jpg"
    	}
	}	
	
	//或者
	{
		"moduleName":"呼吸训练",
		"params":{
			"name": "xxxxx呼吸法.mp4",
			"url": "http://121.41.72.72:81/breatheDrill/xxxxx呼吸法.mp4",
			"iconUrl": "http://121.41.72.72:81/breatheDrill/xxxxx呼吸法.png"
		}
	}	
	
	//人物哄睡和心理电台需要备注orgId
	{
		"moduleName":"人物哄睡",
		"orgId":"1309016879888732160",
		"params":{
			"name":"大王子",
			"link":"https://aod.cos.tx.xmcdn.com/group16/M07/C3/52/wKgDalZkFYfxsVmEAFZLa2t5zMU412.m4a",
			"desc":"大丸子大丸子大丸子大丸子大丸子",
			"surfaceUrl":"http://121.41.72.72:81/coaxSleep/surface/小王子.png"
			}
	}
	//或者
	{
		"moduleName":"心理电台",
		"orgId":"1309016879888732160",
		"params":{
			"name": "你的月亮我的心",
			"radioUrl": "https://aod.cos.tx.xmcdn.com/group15/M0B/25/D5/wKgDZVWBTZfzm9HWAGcp7Zm-BoM011.m4a",
			"surfaceUrl": "https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=322583572,3143843141&fm=26&gp=0.jpg"
			}
	}

	```

	
- #### 4.所有模块或数据添加字段isShow (Boolean),并添加对应的修改接口.
	
	
更新于 2020/11/09

- #### 1.工作日历(管理员添加一条工作日历)  (管理端)
	- ##### 请求数据示例: 
	```
	{"workTime":"2020/11/10 12:00","workContent":"写一篇文档"}
	```
	

- #### 2.添加测评记录(用户使用的测评表记录) (用户端)
###### tips:当resultScore为"bad"时,随机减5-10分
	- ##### 数据示例
	
	```
		{
			"tableName":"情绪自评量表",
			"preface":"心理压力是影响我们身心健康的重要因素。当人们长期身处重压之下，会导致生理生理、认知、情绪和行为上的不良反应，如：头痛、头晕、失眠、记忆力下降、焦虑等",
			"introduce":"理压力是外界环境的变化和机体内部状态所造成的人的生理变化和情绪波动。导致心理压力的因素很多，而且来源、性质不尽相同",
			"userName":"凡天才",
			"userId":"21312312312",
			"selectData":["A","B","C,"E","C","D","A","C","D","A"],
			"time":"2020/11/09 12:00:11",
			"result":"抑郁得分:7,\n焦虑得分:7,\n压力得分:7.",
			"resultdesc":"\u3000\u3000抑郁得分≤9分为正常，10～13分为轻度，14—20分为中度，21～27分为重度，≥28分为非常严重；\t\n\u3000\u3000焦虑得分≤7分为正常，8～9分为轻度，10～14分为中度，15～l9分为重度，≥20分为非常严重；\t\n\u3000\u3000压力得分≤14分为正常，15～l8分为轻度，l9～25分为中度，26～33分为重度，≥34分为非常严重。\t\n",
			"resultScore:"bad"
		}
	```
	
- #### 3.获取测评记录(筛选条件:"用户","时间(日)")  (管理端)
	
	
- #### 4.用户使用记录 (用户端)
###### tips:记录某个用户在某个时间段使用了某个模块,每次用户使用某个模块,用户的心理评分随机加0-3分,可以是0分
	- ##### 数据示例
	```
	//1:人物哄睡  2:心理电台 3:解忧商店 4:呼吸训练 5:减压训练 6:心理游戏 7:心理知识 8:冥想 9:疗愈音乐 10:番茄钟 11:心呼吸 12:心理测评
	{
		"userId":"1234124512451251",
		"moduleId":"1",
		"moduleName:"人物哄睡",
		"time":"123412345641564165465",//统计到日数据
		"desc":"使用描述"
	}
	```
	
- #### 数据统计(筛选条件:"开始时间(日) - 结束时间(日)") (管理端)
	- ##### 数据示例
	```
	{
		"timeStr":"2020/10/09 - 2020/11/09",
		"moduleUseCount":[//模块使用统计  (见接口4)
		
		],
		"measurementUseStatistical":[//测评记录统计 (见接口2)
		
		],
		"userScoreStatistical":{//用户心理评分统计(见接口/user/updateScore)
			"<10":5,
			"10-20":6,
			"20-30":7,
			"30-40":7,
			....
			">100":1
		},
		//后期可能还会加
	}
	```

-	#### 6:2020/10/22 接口user/updateScore 只有对应的管理员可以调用,评分修改都直接从用户的使用情况,后台去修改,当用户当次登录离上次登录时间大于7天时,评分随机减5-10分